---
title: Azure 安全中心的内置漏洞扫描程序
description: Azure 安全中心包含来自 Qualys 的完全集成的漏洞评估解决方案。 本文介绍了如何部署和使用此工具。
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.service: security-center
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/09/2020
ms.author: v-tawe
origin.date: 03/22/2020
ms.openlocfilehash: b7700ac7586334c57470474a37a42c12adca7e90
ms.sourcegitcommit: 134afb420381acd8d6ae56b0eea367e376bae3ef
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/15/2020
ms.locfileid: "83423150"
---
# <a name="integrated-vulnerability-scanner-for-virtual-machines-standard-tier-only"></a>适用于虚拟机（仅适用于标准层）的集成漏洞扫描程序

Azure 安全中心附带的漏洞扫描程序由 Qualys 提供支持。 Qualys 的扫描程序是用于实时识别 Azure 虚拟机中的漏洞的领先工具。 它仅可供标准定价层的用户使用。 你不需要 Qualys 许可证，甚至不需要 Qualys 帐户 - 在安全中心内一切都可以进行无缝处理。

此功能目前以预览版提供。  

> [!NOTE]
> 安全中心支持集成其他供应商提供的工具，但你需要处理许可成本、部署和配置。 有关详细信息，请参阅[部署合作伙伴漏洞扫描解决方案](partner-vulnerability-assessment.md)。 如果选择不使用 Azure 安全中心附带的内置漏洞扫描程序，则还可以根据这些说明来集成组织自己的 Qualys 许可证。

## <a name="deploying-the-qualys-built-in-vulnerability-scanner-standard-tier-only"></a>部署 Qualys 内置漏洞扫描程序（仅适用于标准层）

若要扫描基于 Azure 的虚拟机是否存在漏洞，最简单的方法是使用内置的漏洞扫描程序。 

若要部署漏洞扫描程序扩展，请执行以下操作：

1. 打开 Azure 安全中心并转到“建议”页。 

1. 选择名为“在虚拟机上启用内置漏洞评估解决方案(由 Qualys 提供支持)”的建议。

    [![Azure 安全中心的“建议”页，已筛选到 Qualys 建议](media/built-in-vulnerability-assessment/va-recommendations-enable-selected.png)](media/built-in-vulnerability-assessment/va-recommendations-enable-selected.png#lightbox)

    你的 VM 会出现在以下一个或多个组中：

    * **正常的资源** - 已将漏洞扫描程序扩展部署到这些 VM。
    * **不正常的资源** - 可以将漏洞扫描程序扩展部署到这些 VM。 
    * **不适用的资源** - 这些 VM 不能部署漏洞扫描程序扩展。 你的 VM 可能在此选项卡中，因为它可能在免费定价层上、缺少 ImageReference 类（与自定义映像和从备份还原的 VM 有关，如 [Azure for .NET 文档](https://docs.azure.cn/dotnet/api/microsoft.azure.batch.imagereference?view=azure-dotnet) 中所述），或者未运行受支持的 OS 之一：

        - 所有版本的 Windows    
        - Red Hat Enterprise Linux 6.7、7.6
        - Ubuntu 14.04、18.04
        - CentOS 6.10、7、7.6
        - Oracle Linux 6.8、7.6
        - SUSE Enterprise Linux 12、15
        - Debian 7、8

1. 从“不正常的资源”选项卡中，选择要在其上部署 Qualys 扫描程序的 VM，然后单击“修正”。 

    ![为 Qualys 扫描程序选择 VM](media/built-in-vulnerability-assessment/va-remediating.png)

    系统会在所有选定的 VM 上安装扫描程序扩展。
    
    一旦扩展成功部署，扫描就会自动开始。 然后，扫描会按四小时的时间间隔运行。 此时间间隔是硬编码的，不可配置。 

## <a name="viewing-and-remediating-discovered-vulnerabilities"></a>查看并修正发现的漏洞

当安全中心识别出漏洞时，它会提供结果和相关信息作为建议。 相关信息包括修正步骤、相关 CVE、CVSS 分数，等等。 你可以查看为一个或多个订阅或者为特定虚拟机识别出的漏洞。

若要查看结果并修正识别出的漏洞，请执行以下操作：

1. 打开 Azure 安全中心并转到“建议”页。 

1. 选择名为“修正虚拟机上发现的漏洞(由 Qualys 提供支持)”的建议。

    安全中心会显示当前所选订阅中所有 VM 对应的所有结果。 这些结果按严重性排序。 

    [![所有选定订阅对应的 Qualys 结果的列表](media/built-in-vulnerability-assessment/va-findings-all.png)](media/built-in-vulnerability-assessment/va-findings-all.png#lightbox)

1. 若要按特定的 VM 筛选结果，请打开“受影响的资源”部分，然后单击关注的 VM。 或者，从资源运行状况视图中选择一个 VM，然后查看针对该资源的所有相关建议。

    安全中心会显示该 VM 对应的结果，按严重性排序。 

    [![特定虚拟机对应的结果](media/built-in-vulnerability-assessment/va-findings.png)](media/built-in-vulnerability-assessment/va-findings.png#lightbox)

    在此示例中，你可以看到发现了 94 个漏洞，其中有 5 个是中等严重性。

1. 若要详细了解某个特定漏洞，请选择它。 

    [![漏洞 #91426 的详细信息窗格](media/built-in-vulnerability-assessment/va-vulnerability-details.png)](media/built-in-vulnerability-assessment/va-vulnerability-details.png#lightbox)

    显示的详细信息窗格包含有关此漏洞的大量信息，其中包括：
    
    * 指向所有相关 CVE 的链接（如果可用）
    * 修正步骤
    * 任何其他参考页面

1. 若要修正某个结果，请按照此详细信息窗格中的修正步骤进行操作。



## <a name="exporting-results"></a>导出结果

若要导出漏洞评估结果，需要使用 [Azure Resource Graph](https://www.azure.cn/home/features/resource-graph/) (ARG)。 使用此工具，可以通过强大的筛选、分组和排序功能，快速访问你的云环境中的资源信息。 这是一种通过编程或 Azure 门户查询 Azure 订阅中的信息的快捷有效方法。

有关完整说明和 ARG 查询示例，请参阅此技术社区帖子：[导出 Azure 安全中心的漏洞评估结果](https://techcommunity.microsoft.com/t5/azure-security-center/exporting-vulnerability-assessment-results-in-azure-security/ba-p/1212091)。


## <a name="built-in-qualys-vulnerability-scanner-faq"></a>内置 Qualys 漏洞扫描程序常见问题解答

### <a name="are-there-any-additional-charges-for-the-qualys-license"></a>Qualys 许可证是否需要额外付费？
否。 内置扫描程序可供所有标准层用户免费使用。 “在虚拟机上启用内置漏洞评估解决方案(由 Qualys 提供支持)”建议会部署一个包含所有必要的许可和配置信息的扫描程序。 不需要额外的许可证。 

### <a name="what-permissions-are-required-to-install-the-qualys-extension"></a>安装 Qualys 扩展需要哪些权限？
对于要在其上部署扩展的任何 VM，你需要写入权限。

与其他扩展一样，Azure 安全中心漏洞评估扩展（由 Qualys 提供支持）在 Azure 虚拟机代理之上运行。 因此，它在 Windows 上以本地主机身份运行，在 Linux 上以 Root 身份运行。

### <a name="can-i-remove-the-security-center-qualys-extension"></a>是否可以删除安全中心 Qualys 扩展？ 
如果要从 VM 中删除此扩展，可以手动进行，也可以使用任何编程工具。 

需要准备好以下详细信息：

* 在 Linux 上，该扩展名为“LinuxAgent.AzureSecurityCenter”，提供商名称为“Qualys”
* 在 Windows 上，该扩展名为“WindowsAgent.AzureSecurityCenter”，提供商名称为“Qualys”

### <a name="how-does-the-extension-get-updated"></a>该扩展如何进行更新？
与 Azure 安全中心代理本身以及所有其他 Azure 扩展一样，Qualys 扫描程序的微小更新可以在后台自动进行。 在自动部署前会对所有代理和扩展进行大量测试。

漏洞扫描程序扩展的某些更新可能需要手动部署。 例如，**如果运行的是 v1.0.0.4，则必须执行以下步骤**：

1. 验证 VM 上运行的 Qualys 漏洞扫描程序扩展的版本：

    1. 在 Azure 门户中，打开“虚拟机”。
    1. 选择其上安装了代理的 VM。
    1. 从侧栏导航中，打开“扩展”并选择以下扩展：

        姓名：**WindowsAgent.AzureSecurityCenter** 类型：**Qualys.WindowsAgent.AzureSecurityCenter**

    1. 查看扩展的版本信息。

        ![Qualys 代理扩展版本信息](media/built-in-vulnerability-assessment/qualys-agent-extension-version.png)

    1. 如果版本为 1.0.0.4，请单击“卸载”并等待，直到 VM 的“扩展”页中不再列出该扩展。

    1. 重启 VM。
    
    1. 当 VM 的状态为“正在运行”时，按上面的[部署 Qualys 内置漏洞扫描程序](#deploying-the-qualys-built-in-vulnerability-scanner-standard-tier-only)中所述部署扩展。

### <a name="why-does-my-vm-show-as-not-applicable-in-the-recommendation"></a>为什么我的 VM 在建议中显示为“不适用”？
打开建议时，你会在以下一个或多个组中看到你的 VM：

- **正常的资源** - 已将漏洞扫描程序扩展部署到这些 VM。
- **不正常的资源** - 可以将漏洞扫描程序扩展部署到这些 VM。 
- **不适用的资源** - 这些 VM 不能部署漏洞扫描程序扩展。 你的 VM 可能在此选项卡中，因为它可能在免费定价层上、缺少 ImageReference 类（与自定义映像和从备份还原的 VM 有关，如 [Azure for .NET 文档](https://docs.azure.cn/dotnet/api/microsoft.azure.batch.imagereference?view=azure-dotnet) 中所述），或者未运行受支持的 OS 之一：

    - 所有版本的 Windows
    - Red Hat Enterprise Linux 6.7、7.6
    - Ubuntu 14.04、18.04
    - CentOS 6.10、7、7.6
    - Oracle Linux 6.8、7.6
    - SUSE Enterprise Linux 12、15
    - Debian 7、8

### <a name="what-is-scanned-by-the-built-in-vulnerability-scanner"></a>内置漏洞扫描程序会扫描哪些内容？
该扫描程序在虚拟机上运行，并查找 VM 本身的漏洞。 从虚拟机上，它无法扫描你的网络。

### <a name="does-the-scanner-integrate-with-my-existing-qualys-console"></a>该扫描程序是否与我现有的 Qualys 控制台集成？
安全中心扩展是一个独立于现有 Qualys 扫描程序的工具，并且，由于许可限制，必须在 Azure 安全中心内使用它。

### <a name="microsoft-defender-advanced-threat-protection-also-includes-threat--vulnerability-management-tvm-how-is-the-security-center-vulnerability-assessment-extension-different"></a>Microsoft Defender 高级威胁防护也包括了威胁和漏洞管理 (TVM)。 安全中心漏洞评估扩展有何不同？
Microsoft 正在积极地利用 Windows 中内置的 Microsoft Defender ATP 威胁和漏洞管理解决方案来开发世界级漏洞管理功能。

目前，Azure 安全中心的漏洞管理扩展由 Qualys 提供支持。 这可以确保同时支持 Windows 和 Linux 虚拟机。 Qualys 自己对尚无 CVE 的漏洞的了解也会使此扩展受益。

## <a name="next-steps"></a>后续步骤
本文介绍了用于扫描 VM 的 Azure 安全中心漏洞评估扩展（由 Qualys 提供支持）。 如需相关材料，请参阅以下文章：

- [了解建议的不同元素](security-center-recommendations.md)
- [了解如何修正建议](security-center-remediate-recommendations.md)