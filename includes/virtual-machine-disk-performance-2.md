---
title: include 文件
description: include 文件
services: virtual-machines
ms.service: virtual-machines
ms.topic: include
origin.date: 07/07/2020
author: rockboyfor
ms.date: 10/19/2020
ms.testscope: yes
ms.testdate: 10/19/2020
ms.author: v-yeche
ms.custom: include file
ms.openlocfilehash: b62ac723e4827a5a42a6ea83563c778f18fba2f4
ms.sourcegitcommit: 6f66215d61c6c4ee3f2713a796e074f69934ba98
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/16/2020
ms.locfileid: "92128861"
---
<!--Verified successfully-->

![Dsv3 文档](media/vm-disk-performance/dsv3-documentation.jpg)

最大**非缓存**磁盘吞吐量是虚拟机能够处理的默认存储最大限制。 启用主机缓存时，最大**缓存**存储吞吐量限制是一个单独的限制。 创建虚拟机并附加磁盘时，可以启用主机缓存。 你还可以进行调整，以在现有 VM 上打开和关闭磁盘的主机缓存：

![主机缓存](media/vm-disk-performance/host-caching.jpg)

可以调整主机缓存以满足每个磁盘的工作负荷要求。 对于仅执行读取操作的工作负荷，可以将主机缓存设置为“只读”；对于均衡地执行读取和写入操作的工作负荷，可以将主机缓存设置为“读取/写入”。 如果你的工作负荷不符合上述任一模式，很遗憾，你无法使用主机缓存。 

接下来，让我们继续讨论采用 Standard_D8s_v3 虚拟机的一个示例。 除了这一次，我们将在磁盘上启用主机缓存，现在 VM 的 IOPS 限制为 16,000 IOPS。 附加到 VM 的三个基础 P30 磁盘可处理 5,000 IOPS。

设置：
- Standard_D8s_v3 
    - 缓存的 IOPS：16,000
    - 非缓存 IOPS：12,800
- P30 OS 磁盘 
    - IOPS：5,000
    - 已启用主机缓存 
- 2 个 P30 数据磁盘
    - IOPS：5,000
    - 已启用主机缓存

![主机缓存示例](media/vm-disk-performance/host-caching-example-without-remote.jpg)

现在，使用这个已启用缓存的 Standard_D8s_v3 虚拟机的应用程序会请求 15,000 IOPS。 这些请求将细分为每个附加的基础磁盘 5,000 IOPS，并且不会达到性能上限。

## <a name="combined-uncached-and-cached-limits"></a>组合的非缓存和缓存限制

虚拟机的缓存限制独立于其非缓存限制。 这意味着，你可以在附加到 VM 的磁盘上启用主机缓存，同时也可以不在其他磁盘上启用主机缓存，以允许虚拟机获得缓存限制外加非缓存限制的总存储 IO。 让我们通过一个示例来完成此操作，以便熟悉这些限制如何协同工作。我们将继续使用 Standard_D8s_v3 虚拟机和高级磁盘附加配置。

设置：
- Standard_D8s_v3 
    - 缓存的 IOPS：16,000
    - 非缓存 IOPS：12,800
- P30 OS 磁盘 
    - IOPS：5,000
    - 已启用主机缓存 
- 2 个 P30 数据磁盘 X 2
    - IOPS：5,000
    - 已启用主机缓存
- 2 个 P30 数据磁盘 X 2
    - IOPS：5,000
    - 主机缓存已禁用

![具有远程存储的主机缓存示例](media/vm-disk-performance/host-caching-example-with-remote.jpg)

现在，在 Standard_D8s_v3 虚拟机上运行的应用程序将请求 25,000 IOPS。 此请求被分解为每个附加的基础磁盘 5,000 IOPS，其中 3 个磁盘使用主机缓存，2 个磁盘未使用。 由于使用主机缓存的 3 个磁盘在缓存限制 16,000 内，因此这些请求会成功完成，不会达到存储性能上限。 另外，由于未使用主机缓存的 2 个磁盘在非缓存限制 12,800 内，因此这些请求也会成功完成，不会达到上限。

## <a name="metrics-for-disk-performance"></a>磁盘性能指标
我们在 Azure 上提供了一些指标，它们提供了有关虚拟机和磁盘的性能的见解。 可以通过 Azure 门户直观地查看这些指标，也可以通过 API 调用来检索这些指标。 指标按一分钟间隔进行计算。 以下指标可用于深入了解 VM 和磁盘 IO 及吞吐量性能：
- **OS 磁盘队列深度** - 当前未完成的等待在 OS 磁盘中进行读取或写入操作的 IO 请求数。
- **OS 磁盘读取字节数/秒** - 每秒从 OS 磁盘中读取的字节数。
- **OS 磁盘读取操作数/秒** - 每秒从 OS 磁盘读取的输入操作的数量。
- **OS 磁盘写入字节数/秒** - 每秒在 OS 磁盘中写入的字节数。
- **OS 磁盘写入操作数/秒** - 每秒在 OS 磁盘中写入的输出操作的数量。
- **数据磁盘队列深度** - 当前未完成的等待在数据磁盘中进行读取或写入操作的 IO 请求数。
- **数据磁盘读取字节数/秒** - 每秒从数据磁盘中读取的字节数。
- **数据磁盘读取操作数/秒** - 每秒从数据磁盘读取的输入操作的数量。
- **数据磁盘写入字节数/秒** - 每秒在数据磁盘中写入的字节数。
- **数据磁盘写入操作数/秒** - 每秒在数据磁盘中写入的输出操作的数量。
- **磁盘读取字节数/秒** - 每秒从附加到某个 VM 的所有磁盘中读取的总字节数。
- **磁盘读取操作数/秒** - 每秒从附加到某个 VM 的所有磁盘中读取的输入操作的数量。
- **磁盘写入字节数/秒** - 每秒在附加到某个 VM 的所有磁盘中写入的字节数。
- **磁盘写入操作数/秒** - 每秒在附加到某个 VM 的所有磁盘中写入的输出操作的数量。

## <a name="storage-io-utilization-metrics"></a>存储 IO 利用率指标
有助于诊断磁盘 IO 上限的指标：
- **数据磁盘 IOPS 使用百分比** - 通过将完成的数据磁盘 IOPS 与预配的数据磁盘 IOPS 相比计算得出的百分比。 如果此数为 100%，则正在运行的应用程序将达到你的数据磁盘 IOPS 限制的 IO 上限。
- **数据磁盘带宽使用百分比** - 通过将完成的数据磁盘吞吐量与预配的数据磁盘吞吐量相比计算得出的百分比。 如果此数为 100%，则正在运行的应用程序将达到你的数据磁盘带宽限制的 IO 上限。
- **OS 磁盘 IOPS 使用百分比** - 通过将完成的 OS 磁盘 IOPS 与预配的 OS 磁盘 IOPS 相比计算得出的百分比。 如果此数为 100%，则正在运行的应用程序将达到你的 OS 磁盘 IOPS 限制的 IO 上限。
- **OS 磁盘带宽使用百分比** - 通过将完成的 OS 磁盘吞吐量与预配的 OS 磁盘吞吐量相比计算得出的百分比。 如果此数为 100%，则正在运行的应用程序将达到你的 OS 磁盘带宽限制的 IO 上限。

有助于诊断 VM IO 上限的指标：
- **VM 缓存 IOPS 使用百分比** - 通过将完成的总 IOPS 与最大缓存虚拟机 IOPS 限制相比计算得出的百分比。 如果此数为 100%，则正在运行的应用程序将达到你的 VM 缓存 IOPS 限制的 IO 上限。
- **VM 缓存带宽使用百分比** - 通过将完成的总磁盘吞吐量与最大缓存虚拟机吞吐量相比计算得出的百分比。 如果此数为 100%，则正在运行的应用程序将达到你的 VM 缓存带宽限制的 IO 上限。
- **VM 非缓存 IOPS 使用百分比** - 通过将虚拟机上完成的总 IOPS 与最大非缓存虚拟机 IOPS 限制相比计算得出的百分比。 如果此数为 100%，则正在运行的应用程序将达到你的 VM 非缓存 IOPS 限制的 IO 上限。
- **VM 非缓存带宽使用百分比** - 通过将虚拟机上完成的总磁盘吞吐量与最大预配虚拟机吞吐量相比计算得出的百分比。 如果此数为 100%，则正在运行的应用程序将达到你的 VM 非缓存带宽限制的 IO 上限。

<!-- Update_Description: new article about virtual machine disk performance 2 -->
<!--NEW.date: 10/19/2020-->